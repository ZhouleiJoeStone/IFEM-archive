! OUTPUT generator for both fluids and structure parts
! written by Lucy Zhang
! 12/5/02
! write output in different files each timestep (or less often)
!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
! origin:  ibm code
! n_matlab = 1  :  matlab output
!
! n_ibmfem = 0  :  ibm output
! n_ibmfem = 1  :  fem output
!
! n_tec_ens =1  :  tecplot output
! n_tec_ens =0  :  ensight output
!

       !currentstep = klok/n_step_wr_ib_user_files
       !time_value(currentstep) = klok * td

       if (its == 0) then

          write(*,*) "generating the output"

          if( n_tec_ens == 0) then   !ensight output

             call zfem_ensGeo(klok,ien,x,solid_fem_con,solid_coor_curr)
             call zfem_ensFluid(d,f_fluids,solid_force_FSI,solid_vel,solid_pave,solid_stress,solid_strain,klok)
             call zfem_ensCase(dt,its,ntsbout)

          endif

       elseif (mod(its,ntsbout) == 0) then

          write(*,*) "generating the output"

          if( n_tec_ens == 0) then   !ensight output

             call zfem_ensGeo(klok,ien,x,solid_fem_con,solid_coor_curr)
             call zfem_ensFluid(d,f_fluids,solid_force_FSI,solid_vel,solid_pave,solid_stress,solid_strain,klok)
             call zfem_ensCase(dt,its,ntsbout)

          endif


          !call write_background_mesh(nn,x,ne,nen,ien,ne_surf,nen_surf,ien_surf,d(1:3,:))
          !write(*,*) "backgroundmesh written!!!"



       endif


